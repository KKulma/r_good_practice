---
title: "r_best_practice"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

I've been asked more and more about 


### 01. Use R projects. Always.

Human Civilization was built on conventions. R scripts have them, too. For example 
> Any resident R script is written assuming that it will be run from a fresh R process with working directory set to the project directory. It creates everything it needs, in its own workspace or folder, and it touches nothing it did not create.

You want your project to work. Not only now, but also in 5 years, even if folder and file paths change. Also, you want it to work when your collaborator runs it from their computer. Projects create convention that make it possible.

Basically, they create the nevironment where

1) all code and outputs are stored in one set location (no more `setwd()`!)
2) relative file paths are created - this guarantees better reproducibility 
3) clean R environment is created every time you open it (no more `rm(list = ls())`!) 

If you're not convinced, read [a more thourough explanation given by Jenny Bryan](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/). 

So, go on and start a New Project today! Otherwise, your comouter may be at risk of being set on fire...


![Beware of Jenny Bryan!](pics/jb_tweet.png)





### 02. Describe the purpose of your code / project

Before you even load the packages or import the data, state the purpose and content of your script in hashed code.

```{r comment_example}
### Data import and cleaning from sources A, B and C. 
### This script is part of Segmentation project. 
```

Naturally, you can update it along the way, but having such description in place from day one will guarantee that whoever has access to your script will instantly know what he/she is looking at. Also, if you leave it for later, the chances are that you'll forget to do it altogether and believe me, in X months time when you go back to your code it won't be that clear what were you trying to do here.

### 03. Load all necessary packages in the begining of your script & consider calling functions in a package via `::`

Ok, I know how it is: you load some basic packages to start with, but then the analysis takes to wonderous and wonderful places that require more specialised libraries. So you install and load them along the way... WRONG! Whenever you have to load a new package, go back to the beginning of your script and load them there. This way whenever you (or someone else) have to run the script again, they will have ALL necessary libraries to run it and won't get stuck somewhere in the middle of the execution because the function they called is not recognised. It's coding. Small things matter. 

Also, if you don't want to load the whole package just for the sake of using a single function, consider specifying package directly via `::`. Use this text cleaning exercise as an example:

```{r text_cleaning, eval=FALSE}
library(readr)
library(dplyr)

tweets <- read_csv("tweets.csv")

all_tweets <- tweets %>% 
  rename(author = handle) %>% 
  select(author, text) %>% 
  mutate(text = qdapRegex::rm_url(text)) %>% #removes URLs from text
  na.omit()
```

here, I'm expecting to use `readr` and `dplyr` packages regularly and I'm using `qdapRegex` library only once - to remove URL's from my tweet data. In this case I call `rm_url()` once and I specify the package that it comes from. Easy peasy.

### 04. Name your code chunks and use them for navigation. 

Your code will grow. Sometimes it will turn into an R script equivalent to Bible volume. To keep it organised 

### 05. Make your life easier and mark your code when you need to. 

Did you know that if you click anywhere left from line numbers in RStudio, it will create a red mark? I think this is one of the most underused features in RStudio, and a very useful one, too! Imagine having to define a function using another part of a very long R script? Instead of finding a relevant part of the script and then spending seconds or minutes on finding the function that you were about ot define, you first mark that function, go to the relevant bit of code and then have no problems finding the function to be defined again, as the red mark will tell you where to look. BTW, it works only in already saved R scripts and it doesn't work in RMarkdown files.

<create a gif>

### 06. Write your code as if someone was going to use it without communicating with you. From day one
- commenting
- as clear and efficient as possible
- ideally timed and tested 


### 07. Name your files like a Pro.
 [Jenny Bryan's slides](https://t.co/99waX8liuQ)

### 08. If you have to copy/paste bit of code at least 3 times, write a function. 


### 09. With big, complex data projects use project pipeline.

### 10. Never save the content of your working environment.


### 11. Before publshing/sharing your code, run it in the fresh workspace. 

This almost goes without saying, but if I got a Â£ for every time I forgot to do it...
Basically, stuff happens when you write your code: you work with multiple files, maybe you loaded a package in one of them but forgot to do it in the rest of them? If that's the case, you'll be able to run all scripts in this particular session but if you send someone the code without the imported function... they will fail to run it. The same will happen if you try to run the script on its own, on your own machine. 

Anyway, this doesn't need much explaining. Simply make sure that you re-run your code in a fresh session before you take it further. Amen. 
